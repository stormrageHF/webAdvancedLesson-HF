# 概述
spa 单页面应用
优点：
用户体验好
开发效率高
渲染性能好
可维护性好
缺点：
首屏渲染时间太长：使用js在客户端生成网页内容
不利于 seo
为了解决缺点，使用服务端渲染
客户端激活为 spa

最终为同构应用：
- 通过服务端渲染首屏直出，解决spa应用首屏渲染慢以及不利于seo问题
- 通过客户端渲染接管页面内容交互得到更好的用户体验

这种方式叫现代化服务端渲染，同构渲染
服务端渲染应用或者同构应用


# 什么是渲染
渲染：数据 + 模板 拼接到一起

# 传统的服务端渲染
早期 web 渲染是在服务器完成
客户端                  服务器              数据库
     1. 请求一个地址
                          2. 查询页面所需数据
                            3. 返回数据
                4.将数据结合页面模板渲染成html 
     5. 返回 html 给客户端    

用 nodejs 启动服务器，express 启web服务器

1. 获取页面模板
可以用 fs 读取本地html模板文件(模板语法)，读取的内容是字符串 templateStr

2. 获取数据 data 对象类型
可以从数据库或者其他文件中读取

3. 模板+数据完成渲染
可以使用模板引擎 art-tempalte 语法：{{ 变量 }}
const html = template.render(templateStr,data)

4. 发送渲染结果给客户端
res.send(html)


缺点：
- 前后端代码完成耦合，不利于开发和维护
- 前端没有足够发挥空间
- 服务器压力大
- 用户体验一般


# 客户端渲染
ajax 普及使前端获取数据成为主流
1. 客户端请求地址
2. 服务器返回一个空 html
3. 客户端发送 ajax 请求获取数据
4. 服务器查询数据库后返回数据
5. 客户端用数据渲染到 html


# 为什么客户端首屏渲染慢
spa 首屏渲染慢
1. 客户端第一次加载页面，大概有三类请求都需要时间
2. 第一种是 html 文件的请求，需要耗时，这种请求完成以后才开始第二种
3. 第二种是 js/css/image 等静态资源的请求，需要耗时，html 中引入的文件都是异步请求
4. 第三种是 js文件中的 ajax 请求，也需要耗时
5. 而服务端渲染只需要第一种请求就和图片

# 为什么客户端不利于 seo
seo 是什么？
搜索引擎程序抓取 url 地址，获取网页上的数据，通过关键字，搜索对应的内容，并返回这个网页地址
那服务端渲染的html 是对应一个url地址的，所以 seo 可以获取到网页里的全部内容
而客户端渲染的 html 是一个没有被渲染的没有数据的 html 文件，所以 seo 就算查找到这个 html，seo 也不会去做渲染这种事情，没有渲染没有内容所以关键字也查不到

# 现代化的服务端渲染（同构渲染）

- 基于 vue 和 react 等框架，客户端渲染和服务端渲染相结合
  - 在服务端执行一次，用于实现服务端渲染（首屏直出）
  - 可客户端在渲染一次，用于接管页面交互
- 解决seo和首屏渲染慢的问题
- 拥有传统服务器渲染的优点，也有客户端渲染的优点

同构渲染的解决方案
- 使用 vue 和 react 等框架的官方解决方案
  - 优点：有助于理解原理
  - 缺点：需要搭建环境，比较麻烦
- 使用第三方解决方案
  - react 生态的 Next.js
  - vue 生态的 Nuxt.js


# 通过 Nuxt 体验同构渲染


# 同构渲染的 spa 应用


# 同构渲染问题
- 开发条件有限
  - 浏览器特定的代码只能在某些生命周期钩子函数中使用
  - 一些外部扩展库需要特殊处理才能在服务端渲染中运行
  - 不能在服务端渲染期间操作 dom
  - 某些代码操作需要区分运行环境

- 涉及构建设置和部署的更多要求
客户端渲染：
1. 只需要构建客户端应用即可
2. 可以部署到任意 web 服务器
服务端渲染：
1. 需要构建两个端
2. 只能部署在 nodejs server 上

- 更多的服务端负载
  1. 在 node 中渲染完整的应用程序，相比只提供静态文件的服务器需要大量占用cpu资源
  2. 如果应用在高流量环境下使用，需要准备相应的服务器负载
  3. 需要更多的服务端渲染优化工作处理


服务端渲染使用建议
- 首屏渲染速度是否真的重要 ？
- 是否真的需求 seo ？











